!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.fesAudio=e():t.fesAudio=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=class{constructor(){this._eventsList={}}_emptyFn(){}_hasDispatch(t){return t=(String(t)||"").toLowerCase(),void 0!==this._eventsList[t]}_indexFn(t,e){if(!this._hasDispatch(t))return-1;var i=this._eventsList[t];e=e||"";for(var s=0;s<i.length;s++){var n=i[s].fn||"";if(e.toString()===n.toString())return s}return-1}createDelegate(){var t=this,e=Array.prototype.slice.call(arguments),i=e.shift();return function(){return t.apply(i,e.concat(Array.prototype.slice.call(arguments)))}}dispatchEvent(){if(arguments.length<1)return!1;var t=this;return Array.prototype.slice.call(arguments).every(function(e,i){if(t._hasDispatch(e))return!0;t._eventsList[e.toLowerCase()]=[]}),this}fireEvent(){if(arguments.length<1)return!1;var t=Array.prototype.slice.call(arguments),e=t.shift().toLowerCase(),i=this;if(this._hasDispatch(e)){var s=this._eventsList[e];if(!s)return this;s.every(function(e,s){var n=e.fn,r=e.scope||i;n&&"function"==typeof n||(n=i._emptyFn),!0===r&&(r=null),n.apply(r,t)})}return this}on(t,e,i){if(t=(t||"").toLowerCase(),!this._hasDispatch(t))throw new Error("not dispatch event "+t);return this._eventsList[t].push({fn:e||null,scope:i||null}),this}un(t,e){if(t=(t||"").toLowerCase(),this._hasDispatch(t)){var i=this._indexFn(t,e);i>-1&&this._eventsList[t].splice(i,1)}return this}die(t){return t=(t||"").toLowerCase(),this._eventsList[t]&&(this._eventsList[t]=[]),this}};var n=class extends s{constructor(t){super(),this.input=t,this.stream=null,window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext,this.FREQBINCOUNT=2048,this.freqByteData=new Uint8Array(this.FREQBINCOUNT),this.analyserNode=null,this.baseNodes=[16.352,18.354,20.602,21.827,24.5,27.5,30.868],this.baseNodesNames=["C","D","E","F","G","A","B"],this.currentNode="-",this.dispatchEvent("success"),this.dispatchEvent("failed"),this.input&&"object"==typeof this.input&&this._initMediaElement()}start(){this.input&&"object"==typeof this.input?(console.log("media begin to play"),this.input.play()):this._initStream()}pause(){this.input&&"object"==typeof this.input?this.input.pause():this.stream.getTracks()[0].stop()}getPitch(t){return this.analyserNode.getByteFrequencyData(this.freqByteData),this._checkNote(this.freqByteData)}getLoudness(t){this.analyserNode.getByteFrequencyData(this.freqByteData);for(var e=0,i=6;i<48;i++)e+=this.freqByteData[i];return Math.floor(e/42/255*100)}_initMediaElement(){this.input.onloadeddata=(()=>{this.analyserNode=this.audioContext.createAnalyser(),this.audioContext.createMediaElementSource(this.input).connect(this.analyserNode),this.analyserNode.connect(this.audioContext.destination),this.freqByteData=new Uint8Array(this.analyserNode.frequencyBinCount),this.fireEvent("success")}),this.input.onerror=(()=>{this.fireEvent("failed")})}_initStream(){var t=this;navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia),navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}},this._gotStream.bind(this),function(e){t.fireEvent("failed",e)})}_gotStream(t){this.stream=t;var e=this.audioContext.createGain();this.biquadFilter=this.audioContext.createBiquadFilter(),this.biquadFilter.type="highpass",this.biquadFilter.frequency.setValueAtTime(100,this.audioContext.currentTime),this.biquadFilter.gain.setValueAtTime(25,this.audioContext.currentTime),this.audioContext.createMediaStreamSource(t).connect(e),this.analyserNode=this.audioContext.createAnalyser(),this.analyserNode.fftSize=this.FREQBINCOUNT,e.connect(this.biquadFilter),this.biquadFilter.connect(this.analyserNode);var i=this.audioContext.createGain();i.gain.value=0,e.connect(i),i.connect(this.audioContext.destination),this.freqByteData=new Uint8Array(this.analyserNode.frequencyBinCount),this.fireEvent("success")}_getSoundFreqArray(t){let e=[];for(let i=0;i<9;i++)e.push(t*Math.pow(2,i));return e}_getBar(t){let e=[];for(let i=0;i<9;i++)e.push(Math.ceil(t[i]/21.5));return e}_sumCurrentNodes(t,e){let i=[],s=0,n=0,r=0;for(let a=0;a<t.length;a++){const o=e[t[a]];o>s&&(s=o,r=a),n+=o,i.push(o)}return{sum:n,maxIndex:r,values:i}}_checkNote(t){let e=[],i=[];for(var s=0;s<this.baseNodes.length;s++){let n=this._getBar(this._getSoundFreqArray(this.baseNodes[s])),r=this._sumCurrentNodes(n,t);e.push(r.sum),i.push(r)}let n=Math.max(...e),r=e.indexOf(n);return n>300&&(this.currentNode=this.baseNodesNames[r]+""+i[r].maxIndex),this.currentNode}getInput(){console.log(this.input)}};e.default=n}])});